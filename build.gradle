/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * To learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.6/samples
 */

plugins {
    id 'org.openapi.generator' version '7.12.0'
}

version = '1.0.0'

ext {
    springboot_version = '3.3.0'
    lombok_version = '1.18.30'
    junit_version = '5.10.0'
}

tasks.register("prepareApk", Copy.class) {
    group 'xq'
    from './../xq-mobile-app/android/app/build/outputs/apk/release/app-release.apk'
    into './sunstrike/src/test/resources'
    rename { String fileName ->
        fileName.replace('app-release', 'xq')
    }
}

tasks.register("prepareApp", Copy.class) {
    group 'xq'
    from './../xq-mobile-app/ios/build/Products/Release-iphonesimulator/omitrixmobile.app/'
    into './sunstrike/src/test/resources/xq.app'
}

tasks.register("runStub", Exec.class) {
    group 'xq'
    commandLine 'sh', '-c', 'cd ./stubby-v1 && camouflage -c config.yml'
}

tasks.register("platformTestV1", Exec.class) {
    group 'xq'
    commandLine 'sh', '-c', 'cd ./node-platform-test && yarn t'
}

openApiGenerate {
    group = "xq"
    generatorName = "java" // Specify the generator type
    inputSpec = "$projectDir/api/api-test-plan.yaml" // Path to your OpenAPI spec
    outputDir = "$projectDir/xq-api-test-plan" // Output directory for generated code
    apiPackage = "com.xq.testplan.api.client" // Package for API classes
    modelPackage = "com.xq.testplan.api.model" // Package for model classes
    invokerPackage = "com.xq.testplan.api.invoker" // Package for invoker classes
    configOptions = [
            dateLibrary: "java11",
            addGeneratedAnnotation: "false",
            useTags: "false"
    ]
    library = "native"
    groupId = "com.xq"
    id = "xq-api-test-plan"
}

tasks.register("generateTestPlanTs", org.openapitools.generator.gradle.plugin.tasks.GenerateTask) {
    group = "xq"
    generatorName = "typescript-axios" // Specify the TypeScript generator
    inputSpec = "$projectDir/api/api-test-plan.yaml" // Path to your OpenAPI spec
    outputDir = "$projectDir/xq-api-test-plan-node" // Output directory for generated code
    apiPackage = "api" // Package for API classes
    modelPackage = "model" // Package for model classes
    invokerPackage = "invoker" // Package for invoker classes
    configOptions = [
            supportsES6: "true", // Enable ES6 support
            npmName: "typescript-client", // Name of the generated npm package
            npmVersion: "1.0.0" // Version of the generated npm package
    ]
}



tasks.named("openApiGenerate") {
    doFirst {
        //remove directory
//        def outputDir = new File("$projectDir/xq-api-test-plan/src/main/java/")
//        if (outputDir.exists()) {
//            outputDir.deleteDir()
//        }
    }
    doLast {
        println "OpenAPI code generation completed."
    }
}

